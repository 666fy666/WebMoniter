# å¤šå¹³å°ç›‘æ§å·¥å…·ï¼ˆè™ç‰™ç›´æ’­ã€å¾®åšç­‰ï¼‰

<div align="center">

![Python Version](https://img.shields.io/badge/python-3.10+-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Docker](https://img.shields.io/badge/docker-multi--platform-blue.svg)

ä¸€ä¸ªæ”¯æŒå¤šå¹³å°ç›‘æ§å·¥å…·ï¼ˆè™ç‰™ç›´æ’­ã€å¾®åšç­‰ï¼‰ï¼Œä½¿ç”¨ APScheduler è¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œæ”¯æŒå¤šæ¸ é“æ¨é€ã€‚

[å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [Docker éƒ¨ç½²](#-docker-éƒ¨ç½²æ¨è) â€¢ [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜) â€¢ [Webç®¡ç†ç•Œé¢](#-webç®¡ç†ç•Œé¢) â€¢ [API è°ƒç”¨](#-api-è°ƒç”¨) â€¢ [å¼€å‘æŒ‡å—](#-å¼€å‘æŒ‡å—)

</div>

---

## ğŸ“‹ ç›®å½•

- [æ”¯æŒçš„å¹³å°å’Œæ¨é€é€šé“](#-æ”¯æŒçš„å¹³å°å’Œæ¨é€é€šé“)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
  - [Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰](#-docker-éƒ¨ç½²æ¨è)
  - [æœ¬åœ°å®‰è£…æ­¥éª¤](#-æœ¬åœ°å®‰è£…æ­¥éª¤)
- [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜)
- [Webç®¡ç†ç•Œé¢](#-webç®¡ç†ç•Œé¢)
- [API è°ƒç”¨](#-api-è°ƒç”¨)
- [å¼€å‘æŒ‡å—](#-å¼€å‘æŒ‡å—)
- [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)
- [å‚è€ƒä¸è‡´è°¢](#-å‚è€ƒä¸è‡´è°¢)

---

## ğŸ“Š æ”¯æŒçš„å¹³å°å’Œæ¨é€é€šé“

### ç›‘æ§å¹³å°æ”¯æŒ

| å¹³å°ç±»å‹ | type     | åŠ¨æ€æ£€æµ‹ | å¼€æ’­æ£€æµ‹ |
| -------- | -------- | -------- | -------- |
| è™ç‰™     | huya     | âŒ       | âœ…       |
| å¾®åš     | weibo    | âœ…       | âŒ       |

### æ¨é€é€šé“æ”¯æŒ

| é€šé“ç±»å‹           | type              | æ¨é€é™„å¸¦å›¾ç‰‡ | è¯´æ˜                                                                                                         |
| ----------------- | ----------------- | ------------ | ------------------------------------------------------------------------------------------------------------ |
| Serveré…±_Turbo    | serverChan_turbo  | âœ…           | ğŸ™…â€â™€ï¸ä¸æ¨èï¼Œä¸ç”¨å®‰è£…appï¼Œä½†å…è´¹ç”¨æˆ·5æ¬¡/å¤©ğŸ‘‰[å®˜ç½‘](https://sct.ftqq.com)                                         |
| Serveré…±_3        | serverChan_3      | âœ…           | ğŸ¤”éœ€è¦å®‰è£…appğŸ‘‰[å®˜ç½‘](https://sc3.ft07.com/)                                                                 |
| ä¼ä¸šå¾®ä¿¡è‡ªå»ºåº”ç”¨   | wecom_apps        | âœ…           | ğŸ˜¢æ–°ç”¨æˆ·ä¸å†æ¨èï¼Œ2022å¹´6æœˆ20æ—¥ä¹‹åæ–°åˆ›å»ºçš„åº”ç”¨ï¼Œéœ€è¦é…ç½®å¯ä¿¡IPğŸ‘‰[å®˜ç½‘](https://work.weixin.qq.com/wework_admin/frame#apps/createApiApp) |
| ä¼ä¸šå¾®ä¿¡ç¾¤èŠæœºå™¨äºº | wecom_bot         | âœ…           | ğŸ¥³æ¨èï¼Œæ–°å»ºç¾¤èŠæ·»åŠ è‡ªå®šä¹‰æœºå™¨äººå³å¯ğŸ‘‰[æ–‡æ¡£](https://developer.work.weixin.qq.com/document/path/99110)        |
| é’‰é’‰ç¾¤èŠæœºå™¨äºº     | dingtalk_bot      | âœ…           | ğŸ¥³æ¨èï¼Œæ–°å»ºç¾¤èŠæ·»åŠ è‡ªå®šä¹‰æœºå™¨äººå³å¯ï¼Œè‡ªå®šä¹‰å…³é”®è¯ä½¿ç”¨"ã€"ğŸ‘‰[æ–‡æ¡£](https://open.dingtalk.com/document/robots/custom-robot-access) |
| é£ä¹¦è‡ªå»ºåº”ç”¨       | feishu_apps       | âœ…           | ğŸ¤”å¯ä»¥ä½¿ç”¨ä¸ªäººç‰ˆï¼Œåˆ›å»ºåº”ç”¨ï¼Œæˆäºˆå…¶æœºå™¨äººæƒé™ğŸ‘‰[å®˜ç½‘](https://open.feishu.cn/app?lang=zh-CN)                   |
| é£ä¹¦ç¾¤èŠæœºå™¨äºº     | feishu_bot        | âŒ(æš‚ä¸æ”¯æŒ) | ğŸ¤©æ¨èï¼Œæ–°å»ºç¾¤èŠæ·»åŠ è‡ªå®šä¹‰æœºå™¨äººå³å¯ï¼Œè‡ªå®šä¹‰å…³é”®è¯ä½¿ç”¨"ã€"ğŸ‘‰[æ–‡æ¡£](https://open.feishu.cn/document/client-docs/bot-v3/add-custom-bot) |
| Telegramæœºå™¨äºº    | telegram_bot      | âœ…           | ğŸªœéœ€è¦è‡ªå¤‡ç½‘ç»œç¯å¢ƒğŸ‘‰[æ–‡æ¡£](https://core.telegram.org/bots)                                                   |
| QQé¢‘é“æœºå™¨äºº       | qq_bot            | âœ…           | ğŸ˜¢éœ€è¦è‡ªè¡Œåˆ›å»ºæœºå™¨äººï¼Œå¹¶å¯ç”¨æœºå™¨äººåœ¨é¢‘é“å†…å‘è¨€çš„æƒé™ğŸ‘‰[å®˜ç½‘](https://q.qq.com/#/app/create-bot)               |
| NapCatQQ          | napcat_qq         | âœ…           | ğŸ§å¥½ç”¨ï¼Œä½†éœ€è¦è‡ªè¡Œéƒ¨ç½² NapCatQQğŸ‘‰[é¡¹ç›®åœ°å€](https://github.com/NapNeko/NapCatQQ)                            |
| Bark               | bark              | âŒ           | ğŸé€‚åˆè‹¹æœç³»ç”¨æˆ·ï¼Œååˆ†è½»é‡ï¼Œä½†æ²¡æ³•æ¨é€å›¾ç‰‡ğŸ‘‰[App Store](https://apps.apple.com/cn/app/id1403753865)         |
| Gotify             | gotify            | âŒ           | ğŸ–¥ï¸é€‚åˆè‡ªå»ºæœåŠ¡å™¨ğŸ‘‰[å®˜ç½‘](https://gotify.net)                                                                 |
| Webhook            | webhook           | âœ…(POST)     | âš¡ï¸é€šç”¨çš„æ–¹å¼ï¼Œè¯·æ±‚æ ¼å¼è¯¦è§[é™„å½•](#webhook-æ”¯æŒçš„è¯·æ±‚æ ¼å¼)                                                   |
| PushPlus           | pushplus          | âœ…           | ğŸ“±æ”¯æŒå¤šç§æ¨é€æ¸ é“ï¼ˆå¾®ä¿¡ã€é‚®ä»¶ã€Webhookç­‰ï¼‰ğŸ‘‰[å®˜ç½‘](https://www.pushplus.plus/)                              |
| WxPusher           | wxpusher          | âœ…           | ğŸ“±æ¨è,å¾®ä¿¡æ¶ˆæ¯å®æ—¶æ¨é€æœåŠ¡ï¼Œå¯é€šè¿‡APIå®æ—¶ç»™ä¸ªäººå¾®ä¿¡æ¨é€æ¶ˆæ¯ğŸ‘‰[å®˜ç½‘](https://wxpusher.zjiecode.com/)              |
| ç”µå­é‚®ä»¶           | email             | âœ…           | ğŸ“§é€šç”¨çš„æ–¹å¼                                                                                                  |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ³ Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

æœ¬é¡¹ç›®æ¨èä½¿ç”¨ Docker Compose è¿›è¡Œéƒ¨ç½²ï¼Œæ”¯æŒå¤šå¹³å°æ¶æ„ï¼ˆamd64ã€arm64ï¼‰ï¼Œéƒ¨ç½²ç®€å•ã€ç®¡ç†æ–¹ä¾¿ã€‚

#### å‰ç½®è¦æ±‚

- Docker >= 20.10
- Docker Compose >= 2.0

#### éƒ¨ç½²æ­¥éª¤

**1. å‡†å¤‡é…ç½®æ–‡ä»¶**

```bash
# å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone <repository-url>
cd WebMoniter

# å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿
cp config.yml.sample config.yml

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥ç›‘æ§é…ç½®å’Œæ¨é€é€šé“
vim config.yml  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

**2. å¯åŠ¨æœåŠ¡**

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰
docker compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker compose logs -f
```

**3. éªŒè¯éƒ¨ç½²**

è®¿é—® `http://localhost:8866` æˆ– `http://your-server-ip:8866`ï¼Œä½¿ç”¨é»˜è®¤è´¦å· `admin` / `123` ç™»å½•ã€‚

#### Docker å¸¸ç”¨æ“ä½œ

```bash
# æŸ¥çœ‹çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f                    # å®æ—¶æ—¥å¿—
docker compose logs --tail=100            # æœ€è¿‘100è¡Œ

# åœæ­¢/é‡å¯/æ›´æ–°
docker compose stop                        # åœæ­¢æœåŠ¡
docker compose restart                     # é‡å¯æœåŠ¡
docker compose pull && docker compose up -d  # æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

# å®Œå…¨å¸è½½
docker compose down                        # åœæ­¢å¹¶åˆ é™¤å®¹å™¨
# æ³¨æ„ï¼šæ•°æ®æ–‡ä»¶ï¼ˆdata/ã€logs/ã€config.ymlï¼‰ä¼šä¿ç•™åœ¨æœ¬åœ°
```

#### é…ç½®æ–‡ä»¶çƒ­é‡è½½

**é‡è¦**ï¼šç³»ç»Ÿæ”¯æŒé…ç½®æ–‡ä»¶çƒ­é‡è½½åŠŸèƒ½ï¼Œä¿®æ”¹ `config.yml` å**æ— éœ€é‡å¯å®¹å™¨**ï¼Œé…ç½®ä¼šåœ¨ 5 ç§’å†…è‡ªåŠ¨ç”Ÿæ•ˆã€‚

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹é…ç½®çš„å˜åŒ–å¹¶ç«‹å³åº”ç”¨ï¼š
- âœ… ç›‘æ§å¹³å°é…ç½®ï¼ˆå¾®åš Cookieã€UIDã€å¹¶å‘æ•°ï¼›è™ç‰™ Cookieã€User-Agentã€æˆ¿é—´å·ã€å¹¶å‘æ•°ï¼‰
- âœ… è°ƒåº¦å™¨é…ç½®ï¼ˆç›‘æ§é—´éš”æ—¶é—´ã€æ—¥å¿—æ¸…ç†æ—¶é—´ï¼‰
- âœ… æ¨é€é€šé“é…ç½®ï¼ˆæ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹æ¨é€é€šé“ï¼‰
- âœ… å…æ‰“æ‰°æ—¶æ®µé…ç½®

#### æ•°æ®æŒä¹…åŒ–

æ‰€æœ‰é‡è¦æ•°æ®éƒ½ä¼šä¿å­˜åœ¨æœ¬åœ°ï¼š

- **é…ç½®æ–‡ä»¶**: `./config.yml` - ç›‘æ§å’Œæ¨é€é…ç½®
- **æ•°æ®åº“**: `./data/` - SQLite æ•°æ®åº“æ–‡ä»¶
- **æ—¥å¿—æ–‡ä»¶**: `./logs/` - åº”ç”¨æ—¥å¿—ï¼ˆæŒ‰æ—¥æœŸåˆ†å‰²ï¼‰

åˆ é™¤å®¹å™¨ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œé‡æ–°å¯åŠ¨å®¹å™¨åæ•°æ®ä¼šè‡ªåŠ¨æ¢å¤ã€‚

---

### æœ¬åœ°å®‰è£…æ­¥éª¤

#### ç¯å¢ƒè¦æ±‚

- Python >= 3.10
- uv (Python åŒ…ç®¡ç†å™¨)

#### å®‰è£…æ­¥éª¤

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd WebMoniter

# 2. å®‰è£… uvï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
# macOS / Linux
curl -LsSf https://astral.sh/uv/install.sh | sh
# Windows
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"

# 3. å®‰è£…é¡¹ç›®ä¾èµ–
uv sync --locked

# 4. å¤åˆ¶å¹¶ç¼–è¾‘é…ç½®æ–‡ä»¶
cp config.yml.sample config.yml
# ç¼–è¾‘ config.ymlï¼Œé…ç½®ç›‘æ§ä»»åŠ¡å’Œæ¨é€é€šé“

# 5. å¯åŠ¨ç³»ç»Ÿ
uv run python main.py  # å‰å°è¿è¡Œ
# æˆ–
nohup uv run python main.py > /dev/null 2>&1 &  # åå°è¿è¡Œ
```

**å¯åŠ¨åè®¿é—®**ï¼š
- Webç®¡ç†ç•Œé¢ï¼š`http://localhost:8866`
- é»˜è®¤ç™»å½•è´¦å·ï¼š`admin` / `123`

---

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ç»“æ„

é…ç½®æ–‡ä»¶é‡‡ç”¨ YAML æ ¼å¼ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

1. **ç›‘æ§å¹³å°é…ç½®** (`weibo`, `huya`)
2. **è°ƒåº¦å™¨é…ç½®** (`scheduler`)
3. **å…æ‰“æ‰°æ—¶æ®µé…ç½®** (`quiet_hours`)
4. **æ¨é€é€šé“é…ç½®** (`push_channel`)

### ç›‘æ§ä»»åŠ¡é…ç½®

#### å¾®åšç›‘æ§

```yaml
weibo:
  cookie: your_weibo_cookie  # ä»æµè§ˆå™¨å¼€å‘è€…å·¥å…·è·å–
  uids: uid1,uid2,uid3       # é€—å·åˆ†éš”çš„UIDåˆ—è¡¨
  concurrency: 2              # å¹¶å‘æ•°ï¼Œå»ºè®® 2-5ï¼ˆé¿å…è§¦å‘é™æµï¼‰
```

**è·å– Cookie**ï¼š
1. ç™»å½•å¾®åšç½‘é¡µç‰ˆ
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
3. åœ¨ Network æ ‡ç­¾ä¸­æ‰¾åˆ°ä»»æ„è¯·æ±‚ï¼Œå¤åˆ¶ `Cookie` è¯·æ±‚å¤´

**è·å– UID**ï¼š
- è®¿é—®ç”¨æˆ·ä¸»é¡µï¼ŒURL ä¸­çš„æ•°å­—å³ä¸º UID
- ä¾‹å¦‚ï¼š`https://weibo.com/u/1234567890`ï¼ŒUID ä¸º `1234567890`

#### è™ç‰™ç›‘æ§

```yaml
huya:
  rooms: room1,room2,room3              # é€—å·åˆ†éš”çš„æˆ¿é—´å·åˆ—è¡¨
  concurrency: 10                        # å¹¶å‘æ•°ï¼Œå»ºè®® 5-10
```

**è·å–æˆ¿é—´å·**ï¼š
- ä»è™ç‰™ç›´æ’­é—´ URL è·å–
- ä¾‹å¦‚ï¼š`https://www.huya.com/123456`ï¼Œæˆ¿é—´å·ä¸º `123456`

#### è°ƒåº¦å™¨é…ç½®

```yaml
scheduler:
  huya_monitor_interval_seconds: 65      # è™ç‰™ç›‘æ§é—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤65ç§’
  weibo_monitor_interval_seconds: 300    # å¾®åšç›‘æ§é—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰
  cleanup_logs_hour: 2                   # æ—¥å¿—æ¸…ç†æ—¶é—´ï¼ˆå°æ—¶ï¼‰ï¼Œé»˜è®¤2ç‚¹
  cleanup_logs_minute: 0                 # æ—¥å¿—æ¸…ç†æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ï¼Œé»˜è®¤0åˆ†
  retention_days: 3                      # æ—¥å¿—ä¿ç•™å¤©æ•°ï¼Œé»˜è®¤3å¤©
```

#### å…æ‰“æ‰°æ—¶æ®µé…ç½®

```yaml
quiet_hours:
  enable: false  # æ˜¯å¦å¯ç”¨å…æ‰“æ‰°æ—¶æ®µï¼Œé»˜è®¤false
  start: "22:00"  # å…æ‰“æ‰°æ—¶æ®µå¼€å§‹æ—¶é—´ï¼ˆ24å°æ—¶åˆ¶ï¼Œæ ¼å¼ï¼šHH:MMï¼‰
  end: "08:00"    # å…æ‰“æ‰°æ—¶æ®µç»“æŸæ—¶é—´ï¼ˆ24å°æ—¶åˆ¶ï¼Œæ ¼å¼ï¼šHH:MMï¼‰
```

**åŠŸèƒ½è¯´æ˜**ï¼š
- å¯ç”¨å…æ‰“æ‰°æ—¶æ®µåï¼Œç³»ç»Ÿä¼šåœ¨æŒ‡å®šæ—¶é—´æ®µå†…**é™é»˜è¿è¡Œ**
- ç›‘æ§ä»»åŠ¡ä¼š**æ­£å¸¸æ‰§è¡Œ**ï¼Œç»§ç»­æ£€æµ‹å˜åŒ–å¹¶æ›´æ–°æ•°æ®åº“
- åœ¨å…æ‰“æ‰°æ—¶æ®µå†…æ£€æµ‹åˆ°çš„å˜åŒ–**ä¸ä¼šæ¨é€é€šçŸ¥**ï¼Œä½†ä¼šåœ¨æ—¥å¿—ä¸­è®°å½•
- æ”¯æŒè·¨å¤©è®¾ç½®ï¼ˆä¾‹å¦‚ï¼š22:00 åˆ° 08:00ï¼‰

### æ¨é€é€šé“é…ç½®

æ¨é€é€šé“é…ç½®åœ¨ `push_channel` éƒ¨åˆ†ï¼Œæ”¯æŒé…ç½®å¤šä¸ªæ¨é€é€šé“ã€‚æ¯ä¸ªé€šé“éœ€è¦è®¾ç½®ï¼š

- `name`: é€šé“åç§°ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
- `enable`: æ˜¯å¦å¯ç”¨ï¼ˆ`true`/`false`ï¼‰
- `type`: é€šé“ç±»å‹ï¼ˆè§ä¸Šè¡¨ï¼‰
- å…¶ä»–é€šé“ç‰¹å®šé…ç½®

**é…ç½®ç¤ºä¾‹**ï¼š

```yaml
push_channel:
  # ä¼ä¸šå¾®ä¿¡æœºå™¨äººï¼ˆæ¨èï¼‰
  - name: ä¼ä¸šå¾®ä¿¡æœºå™¨äºº
    enable: true
    type: wecom_bot
    key: your_webhook_key
  
  # é’‰é’‰æœºå™¨äººï¼ˆæ¨èï¼‰
  - name: é’‰é’‰æœºå™¨äºº
    enable: true
    type: dingtalk_bot
    access_token: your_access_token
    secret: your_secret  # å¯é€‰ï¼šåŠ ç­¾å¯†é’¥
  
  # WxPusher
  - name: WxPusher
    enable: true
    type: wxpusher
    app_token: your_app_token
    uids: uid1,uid2        # ç”¨æˆ·IDåˆ—è¡¨ï¼Œé€—å·åˆ†éš”
    topic: topic_id        # å¯é€‰ï¼ŒæŒ‡å®šç¾¤å‘topic_idï¼ˆç¾¤å‘æ¨é€ç”¨ï¼Œè¯¦è§WxPusherå®˜æ–¹æ–‡æ¡£ï¼‰
```

è¯¦ç»†é…ç½®ç¤ºä¾‹è¯·å‚è€ƒ `config.yml.sample` æ–‡ä»¶ã€‚

---

## ğŸŒ Webç®¡ç†ç•Œé¢

ç³»ç»Ÿæä¾›äº†ç¾è§‚æ˜“ç”¨çš„Webç®¡ç†ç•Œé¢ï¼Œæ”¯æŒPCç«¯å’Œç§»åŠ¨ç«¯è®¿é—®ï¼Œæ–¹ä¾¿ç”¨æˆ·è¿›è¡Œé…ç½®ç®¡ç†å’Œæ•°æ®æŸ¥çœ‹ã€‚

### è®¿é—®åœ°å€

å¯åŠ¨ç³»ç»Ÿåï¼Œè®¿é—® `http://localhost:8866` å³å¯æ‰“å¼€Webç®¡ç†ç•Œé¢ã€‚

**Dockeréƒ¨ç½²**ï¼šå¦‚æœä½¿ç”¨Dockeréƒ¨ç½²ï¼Œè¯·ç¡®ä¿å·²æ˜ å°„ç«¯å£ `8866:8866`ï¼Œç„¶åè®¿é—® `http://your-server-ip:8866`

### ç™»å½•ä¿¡æ¯

- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `123`

> âš ï¸ **å®‰å…¨æç¤º**ï¼šé»˜è®¤è´¦å·å¯†ç ä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹ç™»å½•å‡­æ®ã€‚

---

## ğŸ”Œ API è°ƒç”¨

ç³»ç»Ÿæä¾›äº† RESTful API æ¥å£ï¼Œæ–¹ä¾¿ä¸å…¶ä»–ç³»ç»Ÿé›†æˆæˆ–è¿›è¡Œè‡ªåŠ¨åŒ–æ“ä½œã€‚æ‰€æœ‰ API æ¥å£å‡åŸºäº FastAPI æ¡†æ¶å®ç°ã€‚

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:8866`ï¼ˆæœ¬åœ°éƒ¨ç½²ï¼‰æˆ– `http://your-server-ip:8866`ï¼ˆæœåŠ¡å™¨éƒ¨ç½²ï¼‰
- **Content-Type**: `application/json`
- **è®¤è¯æ–¹å¼**: åŸºäº Session çš„è®¤è¯ï¼ˆéƒ¨åˆ†æ¥å£éœ€è¦ç™»å½•ï¼‰

### API ç«¯ç‚¹åˆ—è¡¨

#### 1. è®¤è¯ç›¸å…³

**ç™»å½•**
```http
POST /api/login
Content-Type: application/x-www-form-urlencoded

username=admin&password=123
```

**ç™»å‡º**
```http
POST /api/logout
```

**æ£€æŸ¥è®¤è¯çŠ¶æ€**
```http
GET /api/check-auth
```

#### 2. é…ç½®ç®¡ç†

**è·å–é…ç½®**
```http
GET /api/config?format=json
GET /api/config?format=yaml
```

**ä¿å­˜é…ç½®**
```http
POST /api/config
Content-Type: application/json

{
  "content": "yamlé…ç½®å†…å®¹..."
}
```

æˆ–ä½¿ç”¨ JSON æ ¼å¼ï¼š
```http
POST /api/config
Content-Type: application/json

{
  "config": {
    "weibo": {...},
    "huya": {...},
    ...
  }
}
```

#### 3. æ•°æ®æŸ¥è¯¢

**è·å–ç›‘æ§æ•°æ®**
```http
GET /api/data/{table_name}?page=1&page_size=100
```

æ”¯æŒçš„ `table_name`ï¼š
- `weibo` - å¾®åšç›‘æ§æ•°æ®
- `huya` - è™ç‰™ç›‘æ§æ•°æ®

**è·å–ç›‘æ§çŠ¶æ€ï¼ˆæ— éœ€ç™»å½•ï¼‰**
```http
GET /api/monitor-status
```

è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "success": true,
  "data": {
    "weibo": [
      {
        "UID": "1234567890",
        "ç”¨æˆ·å": "ç¤ºä¾‹ç”¨æˆ·",
        "è®¤è¯ä¿¡æ¯": "è®¤è¯ä¿¡æ¯",
        "ç®€ä»‹": "ç”¨æˆ·ç®€ä»‹",
        "ç²‰ä¸æ•°": 10000,
        "å¾®åšæ•°": 500,
        "æ–‡æœ¬": "æœ€æ–°å¾®åšå†…å®¹",
        "mid": "å¾®åšID"
      }
    ],
    "huya": [
      {
        "room": "123456",
        "name": "ä¸»æ’­åç§°",
        "is_live": true
      }
    ]
  },
  "timestamp": "2024-01-01T12:00:00"
}
```

#### 4. æ—¥å¿—æŸ¥è¯¢

**è·å–æ—¥å¿—**
```http
GET /api/logs?lines=100
```

### API è°ƒç”¨ç¤ºä¾‹

#### Python ç¤ºä¾‹

```python
import requests

# åŸºç¡€URL
BASE_URL = "http://localhost:8866"

# åˆ›å»ºä¼šè¯ä»¥ä¿æŒç™»å½•çŠ¶æ€
session = requests.Session()

# ç™»å½•
login_response = session.post(
    f"{BASE_URL}/api/login",
    data={"username": "admin", "password": "123"}
)
print(login_response.json())

# è·å–é…ç½®
config_response = session.get(f"{BASE_URL}/api/config")
print(config_response.json())

# è·å–ç›‘æ§çŠ¶æ€ï¼ˆæ— éœ€ç™»å½•ï¼‰
status_response = requests.get(f"{BASE_URL}/api/monitor-status")
print(status_response.json())

# è·å–å¾®åšæ•°æ®
weibo_response = session.get(
    f"{BASE_URL}/api/data/weibo",
    params={"page": 1, "page_size": 10}
)
print(weibo_response.json())
```

#### cURL ç¤ºä¾‹

```bash
# ç™»å½•
curl -X POST http://localhost:8866/api/login \
  -d "username=admin&password=123" \
  -c cookies.txt

# è·å–é…ç½®ï¼ˆä½¿ç”¨ä¿å­˜çš„ Cookieï¼‰
curl -X GET http://localhost:8866/api/config \
  -b cookies.txt

# è·å–ç›‘æ§çŠ¶æ€ï¼ˆæ— éœ€ç™»å½•ï¼‰
curl -X GET http://localhost:8866/api/monitor-status

# è·å–æ—¥å¿—
curl -X GET "http://localhost:8866/api/logs?lines=50" \
  -b cookies.txt
```

### é”™è¯¯å¤„ç†

API è¿”å›çš„é”™è¯¯æ ¼å¼ï¼š

```json
{
  "error": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

å¸¸è§ HTTP çŠ¶æ€ç ï¼š
- `200` - è¯·æ±‚æˆåŠŸ
- `400` - è¯·æ±‚å‚æ•°é”™è¯¯
- `401` - æœªæˆæƒï¼ˆéœ€è¦ç™»å½•ï¼‰
- `404` - èµ„æºä¸å­˜åœ¨
- `500` - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

## ğŸ’» å¼€å‘æŒ‡å—

### ä»£ç æ£€æµ‹

é¡¹ç›®ä½¿ç”¨ `black` å’Œ `ruff` è¿›è¡Œä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥ã€‚

#### å®‰è£…å¼€å‘ä¾èµ–

```bash
uv sync --extra dev
```

#### ä»£ç æ ¼å¼åŒ–

ä½¿ç”¨ `black` æ ¼å¼åŒ–ä»£ç ï¼š

```bash
# æ ¼å¼åŒ–æ‰€æœ‰ä»£ç 
uv run black .

# æ£€æŸ¥ä»£ç æ ¼å¼ï¼ˆä¸ä¿®æ”¹æ–‡ä»¶ï¼‰
uv run black --check .
```

#### ä»£ç æ£€æŸ¥

ä½¿ç”¨ `ruff` æ£€æŸ¥ä»£ç ï¼š

```bash
# æ£€æŸ¥ä»£ç å¹¶è‡ªåŠ¨ä¿®å¤
uv run ruff check --fix .

# ä»…æ£€æŸ¥ä»£ç ï¼ˆä¸ä¿®å¤ï¼‰
uv run ruff check .
```

#### è¿è¡Œæµ‹è¯•

```bash
uv run pytest
```

---

## â“ å¸¸è§é—®é¢˜

**Q: å¦‚ä½•æ›´æ–° Cookieï¼Ÿ**  
A: ç›´æ¥ä¿®æ”¹ `config.yml` ä¸­çš„ Cookie å€¼ï¼Œ**æ— éœ€é‡å¯å®¹å™¨æˆ–ç¨‹åº**ã€‚ç³»ç»Ÿæ”¯æŒé…ç½®çƒ­é‡è½½ï¼Œä¼šåœ¨ 5 ç§’å†…è‡ªåŠ¨æ£€æµ‹å¹¶åº”ç”¨æ–°çš„é…ç½®ã€‚

**Q: ç›‘æ§ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œæ€ä¹ˆåŠï¼Ÿ**  
A: 
1. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ `logs/main_*.log` æˆ–ä½¿ç”¨ `docker compose logs`
2. ç¡®è®¤é…ç½®æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ˆYAML è¯­æ³•ï¼‰
3. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. éªŒè¯ Cookie æ˜¯å¦æœ‰æ•ˆ
5. ç¡®è®¤ç›‘æ§ä»»åŠ¡å·²å¯ç”¨ï¼ˆ`enable: true`ï¼‰

**Q: å¦‚ä½•è°ƒæ•´ç›‘æ§é¢‘ç‡ï¼Ÿ**  
A: åœ¨ `config.yml` çš„ `scheduler` éƒ¨åˆ†ä¿®æ”¹å¯¹åº”çš„é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ã€‚**æ— éœ€é‡å¯æœåŠ¡**ï¼Œç³»ç»Ÿæ”¯æŒçƒ­é‡è½½ï¼Œä¼šåœ¨ 5 ç§’å†…è‡ªåŠ¨æ£€æµ‹å¹¶æ›´æ–°ä»»åŠ¡é—´éš”æ—¶é—´ã€‚

**Q: æ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ**  
A: 
- **Docker éƒ¨ç½²**ï¼šæ•°æ®åº“åœ¨ `./data/` ç›®å½•ï¼Œæ—¥å¿—åœ¨ `./logs/` ç›®å½•
- **æœ¬åœ°éƒ¨ç½²**ï¼šæ•°æ®åº“ `data.db` åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œæ—¥å¿—åœ¨ `logs/` ç›®å½•

**Q: Webç•Œé¢æ— æ³•è®¿é—®æ€ä¹ˆåŠï¼Ÿ**  
A: 
1. ç¡®è®¤ç³»ç»Ÿå·²æ­£å¸¸å¯åŠ¨ï¼ˆæ£€æŸ¥æ—¥å¿—ï¼‰
2. ç¡®è®¤ç«¯å£8866æœªè¢«å ç”¨
3. Dockeréƒ¨ç½²æ—¶ç¡®è®¤ç«¯å£æ˜ å°„æ­£ç¡®ï¼ˆ`8866:8866`ï¼‰
4. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿8866ç«¯å£å¼€æ”¾

**Q: å…æ‰“æ‰°æ—¶æ®µå†…ä¼šé—æ¼æ¶ˆæ¯å—ï¼Ÿ**  
A: å…æ‰“æ‰°æ—¶æ®µå†…ï¼Œç›‘æ§ä»»åŠ¡ä¼š**æ­£å¸¸æ‰§è¡Œ**å¹¶æ›´æ–°æ•°æ®åº“ï¼Œä½†**ä¸ä¼šæ¨é€é€šçŸ¥**ã€‚å¦‚æœæ‚¨æ‹…å¿ƒé—æ¼é‡è¦æ¶ˆæ¯ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æˆ–æ•°æ®åº“äº†è§£ç›‘æ§è®°å½•ï¼Œæˆ–å…³é—­å…æ‰“æ‰°æ—¶æ®µåŠŸèƒ½ã€‚

---

## ğŸ“š é™„å½•

### Webhook æ”¯æŒçš„è¯·æ±‚æ ¼å¼

#### GET è¯·æ±‚

```
GET https://xxx.api.com?title={{title}}&content={{content}}
```

#### POST è¯·æ±‚

```
POST https://xxx.api.com
Content-Type: application/json

{
  "title": "é€šçŸ¥æ ‡é¢˜",
  "content": "é€šçŸ¥å†…å®¹",
  "jump_url": "è·³è½¬é“¾æ¥ï¼ˆå¯é€‰ï¼‰",
  "pic_url": "å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰"
}
```

æ”¯æŒçš„æ¨¡æ¿å˜é‡ï¼š
- `{{title}}` - é€šçŸ¥æ ‡é¢˜
- `{{content}}` - é€šçŸ¥å†…å®¹
- `{{jump_url}}` - è·³è½¬é“¾æ¥
- `{{pic_url}}` - å›¾ç‰‡é“¾æ¥

---

## ğŸ“„ å‚è€ƒä¸è‡´è°¢

æœ¬é¡¹ç›®å‚è€ƒäº† [aio-dynamic-push](https://github.com/nfe-w/aio-dynamic-push) é¡¹ç›®çš„è®¾è®¡æ€è·¯å’Œæ¨é€é€šé“å®ç°ï¼Œç‰¹æ­¤è¡¨ç¤ºæ„Ÿè°¢ï¼

**aio-dynamic-push** æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æ•´åˆå¤šå¹³å°åŠ¨æ€/ç›´æ’­å¼€æ’­æé†’æ£€æµ‹ä¸æ¨é€çš„å°å·¥å…·ï¼Œæ”¯æŒ Bç«™ã€å¾®åšã€å°çº¢ä¹¦ã€æŠ–éŸ³ã€æ–—é±¼ã€è™ç‰™ç­‰å¤šä¸ªå¹³å°ã€‚æœ¬é¡¹ç›®åœ¨æ¨é€é€šé“å®ç°å’Œé…ç½®ç»“æ„æ–¹é¢å—åˆ°äº†è¯¥é¡¹ç›®çš„å¯å‘ã€‚

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯,ä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ã€‚

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª â­ Starï¼**

Made with â¤ï¸ by [FY]

</div>
